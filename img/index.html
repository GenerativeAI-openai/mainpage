<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>미디어 업로드</title>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; display: flex; align-items: center; justify-content: center; height:100vh; margin:0 }
    .card { background:#fff; padding:2rem; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); width:320px }
    .card h1 { font-size:1.5rem; margin-bottom:1rem; text-align:center }
    .file-input { margin-bottom:1rem; }
    .file-input label { display:block; margin-bottom:0.5rem; }
    .file-input input { width:100% }
    .btn { width:100%; padding:0.75rem; border:none; background:#0070f3; color:#fff; font-size:1rem; border-radius:8px; cursor:pointer }
    .btn:disabled { background:#999 }
    .status { margin-top:1rem; font-size:0.9rem; color:#333; text-align:center }
  </style>
</head>
<body>
  <div class="card">
    <h1>미디어 업로드</h1>
    <div class="file-input">
      <label for="file">파일 선택</label>
      <input type="file" id="file" accept="image/*,audio/*,video/*" />
    </div>
    <button id="uploadBtn" class="btn" disabled>업로드</button>
    <div id="status" class="status"></div>
  </div>

  <script>
    const fileInput = document.getElementById('file');
    const uploadBtn = document.getElementById('uploadBtn');
    const statusDiv = document.getElementById('status');
    let selectedFile;

    fileInput.addEventListener('change', e => {
      selectedFile = e.target.files[0];
      uploadBtn.disabled = !selectedFile;
      statusDiv.textContent = '';
    });

    uploadBtn.addEventListener('click', () => {
      if (!selectedFile) return;
      const reader = new FileReader();
      reader.onload = async () => {
        const dataUrl = reader.result;
        statusDiv.textContent = '업로드 중...';
        try {
          const res = await fetch('https://kkomaweb.com/upload', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              data: dataUrl,
              filename: `${Date.now()}_${selectedFile.name}`,
              mimeType: selectedFile.type
            })
          });
          const json = await res.json();
          if (json.url) {
            statusDiv.innerHTML = `완료! <a href="${json.url}" target="_blank">미리보기</a>`;
          } else {
            throw new Error(json.error || 'Unknown');
          }
        } catch (err) {
          console.error(err);
          statusDiv.textContent = '업로드 실패';
        }
      };
      reader.readAsDataURL(selectedFile);
    });
  </script>
</body>
</html>
