<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>íšŒì›ê°€ì… ì‹œë®¬ë ˆì´í„°</title>
  <link rel="icon" href="https://i.ibb.co/hJx83Zhy/profile-img.png" type="image/png">
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.google.com/recaptcha/api.js"></script>
</head>
<body>
  <div class="container">
    <h1>íšŒì›ê°€ì…</h1>
    <div class="input-group">
      <label for="nickname">ë‹‰ë„¤ì„</label>
      <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" />
      <button onclick="suggestNickname()" style="display: none;">ë‹‰ë„¤ì„ ì¶”ì²œ</button>
      <p id="nick-msg" class="msg"></p>
    </div>

    <div class="input-group">
      <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
      <!-- <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" /> -->
       <input type="text" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" />
      <p id="pw-msg" class="msg"></p>
    </div>
    <div class="g-recaptcha" data-sitekey="6LcstTUrAAAAAB1h1ahZW1MdlmcY0dZ6j5JPYn4i"></div>
    <button id="submit-btn" disabled>ê°€ì…í•˜ê¸°</button>
    <p class="note">â€» ì‹¤ì œë¡œ ê°€ì…ë˜ì§€ ì•Šìœ¼ë©°, ì—°ìŠµìš© ì‹œë®¬ë ˆì´í„°ì…ë‹ˆë‹¤.</p>
  </div>

<!--   <script src="script.js"></script> -->
</body>
<script>
    const nicknameInput = document.getElementById("nickname");
const passwordInput = document.getElementById("password");
const nickMsg = document.getElementById("nick-msg");
const pwMsg = document.getElementById("pw-msg");
const submitBtn = document.getElementById("submit-btn");

const existingNicknames = ["ê³ ì–‘ì´", "guest123", "admin", "pikachu", "hello123"];
const funnyNames = ["ë©ë•Œë¦¬ê¸°ì¥ì¸", "ë¼ë©´ì€ë¬¼ì¡°ì ˆ", "ê¿€ì ëŸ¬", "ë§ì´ë˜ëŠ”ì†Œë¦¬", "í¬ì¼“ëª¬ì¡°ë ¨ì‚¬"];

nicknameInput.addEventListener("input", validate);
passwordInput.addEventListener("input", validate);
function check_recaptcha(){
  var v = grecaptcha.getResponse();
  if (v.length ==0) {
    //submitBtn.disabled = true;
    return false;
  } else {
    location.reload();
    return true;
  }
}
function suggestNickname() {
  const random = funnyNames[Math.floor(Math.random() * funnyNames.length)];
  nicknameInput.value = random;
  validate();
}
function disassembleHangul(str) {
  const onset = ["ã„±", "ã„²", "ã„´", "ã„·", "ã„¸", "ã„¹", "ã…", "ã…‚", "ã…ƒ", "ã……", "ã…†",
                 "ã…‡", "ã…ˆ", "ã…‰", "ã…Š", "ã…‹", "ã…Œ", "ã…", "ã…"];
  const nucleus = ["ã…", "ã…", "ã…‘", "ã…’", "ã…“", "ã…”", "ã…•", "ã…–", "ã…—", "ã…˜", "ã…™",
                   "ã…š", "ã…›", "ã…œ", "ã…", "ã…", "ã…Ÿ", "ã… ", "ã…¡", "ã…¢", "ã…£"];
  const coda = ["", "ã„±", "ã„²", "ã„³", "ã„´", "ã„µ", "ã„¶", "ã„·", "ã„¹", "ã„º", "ã„»",
                "ã„¼", "ã„½", "ã„¾", "ã„¿", "ã…€", "ã…", "ã…‚", "ã…„", "ã……", "ã…†", "ã…‡",
                "ã…ˆ", "ã…Š", "ã…‹", "ã…Œ", "ã…", "ã…"];
  const result = [];

  for (let i = 0; i < str.length; i++) {
    const ch = str.charCodeAt(i);
    if (ch >= 0xAC00 && ch <= 0xD7A3) {
      const syllableIndex = ch - 0xAC00;
      const onsetIndex = Math.floor(syllableIndex / (21 * 28));
      const nucleusIndex = Math.floor((syllableIndex % (21 * 28)) / 28);
      const codaIndex = syllableIndex % 28;
      result.push(onset[onsetIndex], nucleus[nucleusIndex]);
      if (coda[codaIndex]) result.push(coda[codaIndex]);
    } else {
      result.push(str[i]); // ì˜ë¬¸ì, ìˆ«ì ë“±ì€ ê·¸ëŒ€ë¡œ
    }
  }

  return result;
}
function isSubsequence(smallArr, bigArr) {
  let idx = 0;
  for (let i = 0; i < bigArr.length && idx < smallArr.length; i++) {
    if (smallArr[idx] === bigArr[i]) {
      idx++;
    }
  }
  return idx === smallArr.length;
}

function getLevenshteinDistance(a, b) {
  const matrix = Array.from({ length: b.length + 1 }, (_, i) =>
    Array.from({ length: a.length + 1 }, (_, j) => j === 0 ? i : j === 0 ? i : 0)
  );

  for (let i = 1; i <= b.length; i++) {
    for (let j = 1; j <= a.length; j++) {
      if (a[j - 1] === b[i - 1]) {
        matrix[i][j] = matrix[i - 1][j - 1];
      } else {
        matrix[i][j] = Math.min(
          matrix[i - 1][j] + 1,
          matrix[i][j - 1] + 1,
          matrix[i - 1][j - 1] + 1
        );
      }
    }
  }

  return matrix[b.length][a.length];
}

function similarity(a, b) {
  const longer = a.length > b.length ? a : b;
  const shorter = a.length > b.length ? b : a;
  const distance = getLevenshteinDistance(longer.toLowerCase(), shorter.toLowerCase());
  return (1 - distance / longer.length);
}

function validate() {
  const nickname = nicknameInput.value.trim();
  const password = passwordInput.value;
  let valid = true;

  const taboo = [
    { word: "ì˜ˆìœ", message: "ğŸ˜ ë‹¹ì‹ ì€ ì˜ˆì˜ì§€ ì•ŠìŠµë‹ˆë‹¤ ã…‹" },
    { word: "ì˜ˆë»", message: "ğŸ˜ ë‹¹ì‹ ì€ ì˜ˆì˜ì§€ ì•ŠìŠµë‹ˆë‹¤ ã…‹" },
    { word: "ê·€ì—¬ìš´", message: "ğŸ˜ ë‹¹ì‹ ì€ 1ë„ ê·€ì—½ì§€ ì•ŠìŠµë‹ˆë‹¤ ã…‹" },
    { word: "ê·€ìš”ë¯¸", message: "ğŸ˜ ë‹¹ì‹ ì€ ê¸°ìš”ë¯¸ ì•„ë‹™ë‹ˆë‹¤ ã…‹" },
    //{ word: "ì˜ˆë»", message: "ìê¸°ì• ê°€ ë„˜ì¹˜ì‹œë„¤ìš”. í•˜ì§€ë§Œ ì‹œìŠ¤í…œì€ ì†ì§€ ì•Šì•„ìš”!" },
    { word: "ì˜ìƒê¹€", message: "ê·¸ë ‡ê²Œ ì˜ìƒê¸°ì…¨ë‹¤êµ¬ìš”? ê¸€ì„ìš”... ğŸ˜" },
    { word: "ê´€ë¦¬ì", message: "ê´€ë¦¬ìëŠ” ì•„ë¬´ë‚˜ ë˜ëŠ” ê²Œ ì•„ë‹ˆì—ìš”~" },
    { word: "admin", message: "admin? ê¿ˆë„ ê¾¸ì§€ ë§ˆì„¸ìš”." },
    // { word: "ã…‚ã……", message: "ì… ì¢€ ì¡°ì‹¬í•´ì£¼ì„¸ìš”. ì €í¬ëŠ” ì°©í•œ ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤" },
    // { word: "fuck", message: "ê·¸ëŸ° ë‹¨ì–´ëŠ” NO! ğŸ˜¡" },
    // { word: "sh1t", message: "ê·¸ê±´ ì•ˆë¼ìš”... ğŸ‘€" }
  ];
  if (nickname) {
    for (const item of taboo) {
      const userJamo = disassembleHangul(nickname.toLowerCase());
      const tabooJamo = disassembleHangul(item.word.toLowerCase());

      if (isSubsequence(tabooJamo, userJamo)) {
        nickMsg.textContent = item.message;
        submitBtn.disabled = true;
        return;
      }
    }
  } else {
    nickMsg.textContent = "ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.";
    submitBtn.disabled = true;
  }

  if (existingNicknames.includes(nickname)) {
    nickMsg.textContent = "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.";
    valid = false;
  } else if (nickname.length < 2) {
    nickMsg.textContent = "ë‹‰ë„¤ì„ì€ 2ì ì´ìƒì´ì–´ì•¼ í•´ìš”!";
    valid = false;
  } else {
    nickMsg.textContent = "";
  }
//!Ab1
  const errors = [];
  if (password.length < 4) errors.push("ì§§ì•„ìš”â€¦ ë„ˆë¬´ ì§§ì•„ì„œ ë§ˆìŒì´ ì•„íŒŒìš” ğŸ˜¢");//ë„ˆë¬´ ì§§ì•„ìš” (8ì ì´ìƒ)
  if (!/[A-Z]/.test(password)) errors.push("ëŒ€ë¬¸ìê°€ ì—†ì–´ìš”. í˜¹ì‹œ CAPS LOCK ê³ ì¥ë‚¬ë‚˜ìš”?");//ëŒ€ë¬¸ì 1ê°œëŠ” ë„£ì–´ì¤˜ì•¼ì£ 
  if (!/[a-z]/.test(password)) errors.push("ì†Œë¬¸ìë„ ìˆì–´ì•¼ í•©ë‹ˆë‹¤~");//ì†Œë¬¸ìë„ ìˆì–´ì•¼ í•©ë‹ˆë‹¤~
  if (!/[0-9]/.test(password)) errors.push("ìˆ«ìë„ ì¹œêµ¬ì˜ˆìš”. ì–˜ë„ ë„£ì–´ì¤˜ìš”");//ìˆ«ìë„ í•˜ë‚˜ì¯¤?
  if (!/[!@#$%^&*()]/.test(password)) errors.push("íŠ¹ìˆ˜ë¬¸ì ì—†ì´ ì‚´ ìˆ˜ ìˆë‹¤ê³  ìƒê°í•´ìš”? ì„¸ìƒì€ ê·¸ë ‡ê²Œ ì‰½ì§€ ì•Šì•„ìš”");//íŠ¹ìˆ˜ë¬¸ìê°€ ì•ˆ ë³´ì´ë„¤ìš”?
  if (/[ã„±-ã…ã…-ã…£ê°€-í£]/.test(password)) errors.push("í•œê¸€ì€ ë¹„ë°€ë²ˆí˜¸ë¡œ ì“°ê¸°ì—” ë„ˆë¬´ ì•„ë¦„ë‹¤ì›Œìš”. ì•ˆ ë¼ìš” ğŸ’”");//í•œê¸€ì€ ë¹„ë°€ë²ˆí˜¸ë¡œ ì“°ë©´ ì•ˆë¼ìš” ğŸ˜…
  if (["password", "12345678", "qwerty"].some(p => password.toLowerCase().includes(p))) {
    errors.push("ì´ê±´ ë„ˆë¬´ í”í•œ ë¹„ë°€ë²ˆí˜¸ ì•„ë‹Œê°€ìš”?");//ì´ê±´ ë„ˆë¬´ í”í•œ ë¹„ë°€ë²ˆí˜¸ ì•„ë‹Œê°€ìš”?
  }
  if (password.length > 4) {
     errors.push("ê¸¸ì–´ìš”â€¦ ë„ˆë¬´ ê¸¸ì–´ì„œ ê°€ìŠ´ì´ ì°¢ì–´ì ¸ìš” ğŸ˜¢");
  }

  if (errors.length > 0) {
    //pwMsg.textContent = ""
    // for (i = 0; i < errors.length; i ++) {
    //   pwMsg.textContent += `${errors[i]}\n`;
    // }
    //pwMsg.textContent = errors.join("");
    pwMsg.innerHTML = errors.map(e => "â€¢ " + e).join("<br>");//"ë¹„ë°€ë²ˆí˜¸ ë¬¸ì œ:<br>" + errors.map(e => "â€¢ " + e).join("<br>");
    valid = false;
  } else {
    pwMsg.textContent = "";
  }
  submitBtn.disabled = !valid;
  submitBtn.disabled = !check_recaptcha()
}
document.addEventListener("DOMContentLoaded", check_recaptcha())
</script>
</html>
